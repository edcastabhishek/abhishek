var GmCXt;let stepAudio={},userPrefAudio=!1;(GmCXt=void 0===GmCXt?{}:GmCXt).msgChannel||(GmCXt.msgChannel=new MessageChannel),0<document.querySelectorAll(".mgPlayerJSProd_audio-iframe-icons").length&&window.top.postMessage("Guide:audioIframe","*",[GmCXt.msgChannel.port2]),GmCXt.modifyElements=function(e,t,a){e.forEach(e=>{switch(t){case"show":e.style.display="block";break;case"hide":e.style.display="none";break;case"addClass":e.classList.add(a);break;case"removeClass":e.classList.remove(a)}})},GmCXt.setAudioModeOn=function(){document.getElementsByClassName("mgPlayerJSProd_play-step-audio-on")&&document.getElementsByClassName("mgPlayerJSProd_play-step-audio-on").length?(GmCXt.modifyElements(document.querySelectorAll(".mgPlayerJSProd_play-step-audio-on"),"show"),GmCXt.modifyElements(document.querySelectorAll(".mgPlayerJSProd_play-step-audio-off"),"hide"),GmCXt.modifyElements(document.querySelectorAll(".mgPlayerJSProd_play-step-audio"),"addClass","playing-audio"),userPrefAudio&&GmCXt.formatAndSendToParentWindow("mgPlayerJSProd_action:set_audio_storage",{stepAudioRunningStatus:!0})):GmCXt.formatAndSendToParentWindow("mgPlayerJSProd_action:set_audio_mode_on",{})},GmCXt.setAudioModeOff=function(){document.getElementsByClassName("mgPlayerJSProd_play-step-audio-off")&&document.getElementsByClassName("mgPlayerJSProd_play-step-audio-off").length?(GmCXt.modifyElements(document.querySelectorAll(".mgPlayerJSProd_play-step-audio-on"),"hide"),GmCXt.modifyElements(document.querySelectorAll(".mgPlayerJSProd_play-step-audio-off"),"show"),GmCXt.modifyElements(document.querySelectorAll(".mgPlayerJSProd_play-step-audio"),"removeClass","playing-audio"),userPrefAudio&&GmCXt.formatAndSendToParentWindow("mgPlayerJSProd_action:set_audio_storage",{stepAudioRunningStatus:!1})):GmCXt.formatAndSendToParentWindow("mgPlayerJSProd_action:set_audio_mode_off",{})},void 0===GmCXt.requestHandler&&(GmCXt.requestHandler={}),GmCXt.requestHandler.playAudioTrack=function(e){GmCXt.playStepAudio(e)},GmCXt.isEmpty=function(e){return"boolean"!=typeof e&&"number"!=typeof e&&!(e&&("object"==typeof e&&e.constructor===Object?Object.keys(e).length:"object"==typeof e&&e.constructor===Array?e.length:"string"!=typeof e||e.trim()))},GmCXt.getCdnSign=function(){let e="";return e=GmCXt.user&&!GmCXt.isEmpty(GmCXt.user)?GmCXt.user.cdn_signature:e},GmCXt.convertMgdata=function(e){return e.action&&-1!==e.action.indexOf("init_sfdc_env")||e.data&&e.data.config&&e.data.config.appConfig&&"westpac"===e.data.config.appConfig.customer&&e.action&&-1!==e.action.indexOf("MyGuideReporting")||(e.data=e.mgdata),e},GmCXt.syncPlayerInst=function(e){return"mgPlayerJSProd_action:started;task:select_existing_dom_element"===e||"mgPlayerJSProd_action:started;task:select_existing_dom_element:target_frame_only"===e||"mgPlayerJSProd_action:started;task:select_dom_element_tooltips"===e||"mgPlayerJSProd_action:task:init_new_iframe"===e||"mgPlayerJSProd_action:update_player_instance"===e||"mgPlayerJSProd_action:update_player_instance_app"===e||"mgPlayerJSProd_action:set_audio_mode_off"===e||"mgPlayerJSProd_action:set_audio_mode_on"===e||"mgPlayerJSProd_action:close_guide"===e||"mgPlayerJSProd_action:set_style_audio_icon_response"===e},window.addEventListener("message",function(e){GmCXt=GmCXt||e.target.GmCXt;let t=(e=>{e=e.data;try{return"object"==typeof e?e:""===e||"AS"===e||"na"===e||"[object Object]"===e||void 0===e||"undefined"===e?{}:JSON.parse(e)}catch(e){return{}}})(e);if(t&&t.action&&0===t.action.indexOf("mgPlayerJSProd_action:"))switch((t=GmCXt.convertMgdata(t)).data&&(t.data.config&&(GmCXt.conf=t.data.config),t.data.user&&Object.keys(t.data.user).length&&(GmCXt.user=t.data.user),GmCXt.syncPlayerInst(t.action))&&t.data.playerInstance&&(GmCXt.playerI=t.data.playerInstance),t.action){case"mgPlayerJSProd_action:set_audio_mode_on":GmCXt.setAudioModeOn();break;case"mgPlayerJSProd_action:set_audio_mode_off":GmCXt.setAudioModeOff();break;case"mgPlayerJSProd_action:set_style_audio_icon_response":document.documentElement.insertAdjacentHTML("beforeend",t.data.data),document.querySelectorAll(".mgPlayerJSProd_audio-iframe-icons").forEach(e=>{e.removeAttribute("style")}),GmCXt.formatAndSendToParentWindow("mgPlayerJSProd_action:hide_pop_audio_ctrl",{})}},!1),GmCXt.pauseAudio=function(){GmCXt.audioObject&&GmCXt.audioObject.pause()},GmCXt.checkAssetUrl=function(e,t,a){e===t?a(e):GmCXt.checkFileExist(e).then(function(){a(e)}).catch(function(e){a(t)})},GmCXt.playStepAudio=function(n){var e;GmCXt.isPageReloaded=!1,GmCXt.setAudioModeOn(),n&&n.data||GmCXt.playerI&&(e=GmCXt.stepFromPlayerI(GmCXt.playerI.currentStepId),n={audioTrack:e.step_audio,step:e});let t=n.audioTrack;t&&-1===t.indexOf(GmCXt.user.cdn_signature.split("=")[0])&&(t+=GmCXt.getCdnSign()),GmCXt.checkAssetUrl(t,t,function(e){fetch(e).then(e=>{if(e.ok)return e.blob();throw new Error("HTTP error! Status: "+e.status)}).then(e=>{let t=URL.createObjectURL(e);e=n.step;GmCXt.audioObject&&GmCXt.audioObject.pause(),GmCXt.audioObject=new Audio(t);let a="mgPlayerJSProd_action:start_step_completion_timeout",o={step:e};GmCXt.audioObject.onended=function(){URL.revokeObjectURL(t),GmCXt.formatAndSendToParentWindow(a,o)};e=GmCXt.audioObject.play();void 0!==e&&e.then(function(){}).catch(function(e){console.log("Audio Track Fail",e),URL.revokeObjectURL(t),GmCXt.formatAndSendToParentWindow(a,o),GmCXt.setAudioModeOff()})})})},GmCXt.stopAudio=function(){GmCXt.audioObject&&GmCXt.audioObject.pause()},GmCXt.stepFromPlayerI=function(t){let a=!1;var o=GmCXt.playerI.tour.steps;for(let e=0;e<o.length;e++)if(parseInt(o[e].step_id)===parseInt(t)){a=o[e];break}return a.step_description||(a.step_description=" "),a.image_url=a.image_url+GmCXt.getCdnSign(),a.screen_url=a.screen_url+GmCXt.getCdnSign(),a},GmCXt.formatAndSendToParentWindow=function(e,t){var a={};a.action=e,a.data=t||{},!GmCXt.playerI&&null!==GmCXt.playerI||(a.data.playerInstance=GmCXt.playerI),a.data&&"object"==typeof a.data&&(GmCXt.isSidePanelApp&&(a.data.fromSidePanel=GmCXt.isSidePanelApp),"mgPlayerJSProd_action:payload_event_call"!==a.action&&(a.data.user=GmCXt.user),"mgPlayerJSProd_action:payload_event_call"===a.action)&&delete a.data.fromSidePanel,a.data&&a.data.config&&a.data.config.appConfig&&"westpac"===a.data.config.appConfig.customer&&-1!==a.action.indexOf("MyGuideReporting")?GmCXt.msgChannel.port1.postMessage(a):(a.data&&(a.mgdata=a.data,delete a.data),GmCXt.msgChannel.port1.postMessage(JSON.stringify(a)))},document.querySelectorAll(".mgPlayerJSProd_play-step-audio-on").forEach(e=>{e.removeEventListener("click",GmCXt.audioOnBtnClick),e.addEventListener("click",function(){GmCXt.audioOnBtnClick()})}),document.querySelectorAll(".mgPlayerJSProd_play-step-audio-off").forEach(e=>{e.removeEventListener("click",GmCXt.audioOffBtnClick),e.addEventListener("click",function(){GmCXt.audioOffBtnClick()})}),GmCXt.audioOnBtnClick=function(){userPrefAudio=!0,GmCXt.stopAudio(),GmCXt.setAudioModeOff(),GmCXt.formatAndSendToParentWindow("mgPlayerJSProd_action:pause_playing_audio",{})},GmCXt.audioOffBtnClick=function(){var e;userPrefAudio=!0,GmCXt.playerI&&(e=GmCXt.stepFromPlayerI(GmCXt.playerI.currentStepId),message={audioTrack:e.step_audio,step:e},GmCXt.isPageReloaded=!1,GmCXt.playStepAudio(message))},document.addEventListener("DOMContentLoaded",function(){GmCXt.formatAndSendToParentWindow("mgPlayerJSProd_action:set_style_audio_icon",{})});